---
title: "metagene"
output: html_notebook
version: 
---

```{r}
source("https://bioconductor.org/biocLite.R")
biocLite("GenomicRanges")
biocLite("ggplot2")
biocLite("rtracklayer")
library("rtracklayer")
library("GenomicRanges")
library("ggplot2")
```

Constructing genomic intervals of interest
```{r}
source("/home/immd0754/Documents/R_things/General R scripts/metagene/regionlist_length_yeast_FUN.R")
res <- regionlist(plus=1000, minus=500, pos_strand="/home/immd0754/S_MELLOR/Rosa/pos_strand_annotations.bed", neg_strand="/home/immd0754/S_MELLOR/Rosa/neg_strand_annotations.bed")


promoter_region <- res$promoter_region
genes_plus <- res$genes_plus
genes_minus <- res$genes_minus


## Don't use at it is because it makes the promoter region list longer??
#source("C:/Users/immd0754/Documents/R_things/General R scripts/metagene/overlap1_FUN.R")
#promoter_region <- overlap1(promoter_region, genes_plus, genes_minus, minus=500)

```



Data import
```{r}
source("/home/immd0754/Documents/R_things/General R scripts/metagene/filelist_FUN.R")
filesbw <- filelist("/home/immd0754/S_MELLOR/Rosa/cerevisiae_dataForRosa", "uzun", MinPlus_ann=c("plus|posstrand|unipos","minus|negstrand|unimin"))
``` 






```{r}
source("/home/immd0754/Documents/R_things/General R scripts/metagene/bw_to_countmatrix_FUN.R")
overview <- bw_to_countmatrix(filesbw, genes_minus, genes_plus, plus, minus, MinPlus_ann=c("plus|posstrand|unipos","minus|negstrand|unimin"))

###Reverse rownames of negative strands: WORKS ONLY AS LONG AS genes_minus is first half, otherwise you have to change this bit
source("/home/immd0754/Documents/R_things/General R scripts/metagene/revneg_array_FUN.R")
overview_rev <- revneg(overview, genes_minus)

## Normalisation
source("/home/immd0754/Documents/R_things/General R scripts/metagene/normalise_array_FUN.R")
overview_rev_norm <- normalise_array(overview_rev, filesbw)

source("C:/Users/immd0754/Documents/R_things/General R scripts/metagene/bin_sum_withapply_FUN.R")
m <- apply(overview_rev_norm, 3, colSums)


############ what has happened to genes that are overlapping. Multiple transcription start sites.

```


```{r}
source("C:/Users/immd0754/Documents/R_things/General R scripts/metagene/graph_samples_fun.R")
graph_samples(t(m), plus=1000, minus=500, numberbin, name="booth")
```
















```{r}
#f <- function(x) length( intersect(seq(x[1],x[2],1), seq(x[3],x[4],1)) )

#a <- apply(X,1,f)






```




